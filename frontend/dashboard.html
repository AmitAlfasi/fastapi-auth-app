<!DOCTYPE html>
<!-- 
    Dashboard/Home Page
    This is the authenticated user's home page.
    Features:
    - Protected route (requires valid access token)
    - Displays personalized welcome message
    - Logout functionality
    - Automatic redirect to login if unauthorized
    - Fetches user data from protected API endpoint
-->
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Home</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="container">
        <h2>Home</h2>
        <p id="welcome-message">Loading...</p>
        <div class="logout-container">
            <button onclick="logout()">Logout</button>
        </div>
    </div>

    <script>
        async function fetchUserHome() {
            const token = localStorage.getItem("access_token");
            if (!token) {
                window.location.href = "index.html";
                return;
            }

            try {
                const response = await fetch("http://127.0.0.1:8000/user/home", {
                    headers: {
                        "Authorization": `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    throw new Error("Unauthorized");
                }

                const data = await response.json();
                document.getElementById("welcome-message").textContent = data.message;
            } catch (err) {
                console.error(err);
                window.location.href = "index.html";
            }
        }

        function logout() {
            localStorage.removeItem("access_token");
            window.location.href = "index.html";
        }

        // Load data on page load
        fetchUserHome();
    </script>
</body>

</html>